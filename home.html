<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Donation Website</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ©¸</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 

    
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-heartbeat"></i>
                    <h1>Blood Bro's</h1>
                </div>
                <a href="form.html">
                    <button class="donate-button">
                        <i class="fas fa-hand-holding-heart"></i>
                        Donate Blood
                    </button>
                </a>
                <!-- Smart Assistant Button -->
                <a href="blood information.html">
                    <button class="smart-assistant-button">
                        <i class="fas fa-comment-dots"></i>
                        Blood Group Information
                    </button>
                </a>
               
                
            </div>
        </div>
    
    </header>

    <section class="hero container">
        <h2>Your Donation Can Save Lives</h2>
        <p>Every drop counts. Join our community of donors and help those in need. It takes just a few minutes to make a difference that lasts a lifetime.</p>
    </section>

    <!-- Filter Section -->
    <div class="container">
        <div class="filter-container">
            <div class="filter-title">
                <i class="fas fa-filter"></i>
                <span>Search Donors</span>
            </div>
            <div class="filter-options">
                <div class="filter-group">
                    <label for="bloodGroupFilter">Blood Group</label>
                    <select id="bloodGroupFilter">
                        <option value="">All Blood Groups</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="stateFilter">State</label>
                    <select id="stateFilter" onchange="loadDistricts()">
                        <option value="">All States</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                        <option value="Telangana">Telangana</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="districtFilter">District</label>
                    <select id="districtFilter" onchange="loadCities()">
                        <option value="">All Districts</option>
                        <!-- Districts will be populated based on state selection -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="cityFilter">City/Town/Village</label>
                    <select id="cityFilter">
                        <option value="">All Cities/Towns/Villages</option>
                        <!-- Cities will be populated based on district selection -->
                    </select>
                </div>
            </div>
            <div class="filter-buttons">
                <button class="apply-filter" onclick="applyFilters()">
                    <i class="fas fa-check"></i> Search
                </button>
                <button class="reset-filter" onclick="resetFilters()">
                    <i class="fas fa-undo"></i> Reset
                </button>
            </div>
        </div>
        
        <!-- Donor list -->
        <div class="donors-list">
            <h2 style="text-align: center;">Available Donors</h2>
            <ul id="donorList">
                <!-- Donor list will be populated by JavaScript -->
            </ul>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-container">
                <div class="footer-links">
                    <a href="about.html">About Us</a>
                    <a href="FAQ.html">FAQ</a>
                    <a href="Privacy Policy Page.html">Privacy Policy</a>
                    <a href="contact.html">Contact</a>
                </div>
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.instagram.com/blood_heros_srkr?igsh=MWF3OGFlamRndG9lMg==" class="social-icon"><i class="fab fa-instagram"></i></a>
                </div>
                <p>&copy; 2025 Blood Bro's. All rights reserved.</p>
                <p>Contact us: BloodBros@gmail.com</p>
            </div>
        </div>
    </footer>

    <script>
         const themeToggle = document.getElementById("themeToggle");

    // Function to toggle theme
    function toggleTheme() {
        const currentTheme = document.body.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";

        document.body.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);

        // Optional: Animate transition
        document.body.classList.add("theme-transitioning");
        setTimeout(() => {
            document.body.classList.remove("theme-transitioning");
        }, 500);
    }

    // Event listener
    if (themeToggle) {
        themeToggle.addEventListener("click", toggleTheme);
    }

    // Load saved theme from localStorage on page load
    window.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem("theme") || "light";
        document.body.setAttribute("data-theme", savedTheme);
    });

       // Location data for Andhra Pradesh and Telangana
// Location data for Andhra Pradesh and Telangana
const locationData = {
    "Andhra Pradesh": {
        "Anantapur": [
            "Anantapur", "Dharmavaram", "Hindupur", "Kadiri", "Tadipatri", "Peddapalli", "Rayadurg",
            "Uravakonda", "Gooty", "Pamidi", "Kalyandurg", "Penukonda", "Bukkapatnam", "Singanamala",
            "Beluguppa", "Raptadu", "Settur", "Guntakal", "Bathalapalle", "Atmakur", "Roddam"
        ],
        "Chittoor": [
            "Chittoor", "Tirupati", "Madanapalle", "Srikalahasti", "Puttur", "Kuppam", "Vellore",
            "Nagari", "Palamaner", "Gurramkonda", "Pileru", "Kalikiri", "Bangarupalem", "Chandragiri",
            "Renigunta", "Pakala", "Satyavedu", "Thottambedu", "Punganur", "Horsley Hills", "Gangadhara Nellore"
        ],
        "East Godavari": [
            "Kakinada", "Rajahmundry", "Amalapuram", "Mandapeta", "Peddapuram", "Kothapeta", "Ramachandrapuram",
            "Tuni", "Samalkota", "Ravulapalem", "Rajolu", "Yeleswaram", "Anaparthi", "Prathipadu",
            "Uppada", "Korukonda", "Kotananduru", "I. Polavaram", "Tallarevu", "Allavaram", "Razole"
        ],
        "Guntur": [
            "Guntur", "Tenali", "Mangalagiri", "Narasaraopet", "Chilakaluripet", "Bapatla", "Ponnur", "Prathipadu",
            "Sattenapalle", "Pedakakani", "Repalle", "Amaravati", "Vemuru", "Macherla", "Vinukonda",
            "Gurazala", "Tsundur", "Rentachintala", "Nizampatnam", "Kollipara", "Tadikonda"
        ],
        "Krishna": [
            "Vijayawada", "Machilipatnam", "Nuzvid", "Gudivada", "Jaggaiahpeta", "Kankipadu", "Vuyyuru", "Chandarlapadu",
            "Avanigadda", "Pamarru", "Movva", "Penamaluru", "Gannavaram", "Bantumilli", "Kanchikacherla",
            "Mylavaram", "Tiruvuru", "Nagayalanka", "Ghantasala", "Bapulapadu", "Kaikaluru"
        ],
        "Kurnool": [
            "Kurnool", "Nandyal", "Adoni", "Yemmiganur", "Dhone", "Nallamada", "Peddagoni", "Kallur",
            "Banaganapalle", "Koilkuntla", "Bethamcherla", "Devanakonda", "Srisailam", "Mahanandi",
            "Holagunda", "Allagadda", "Kodumur", "Aspari", "Pathikonda", "Jupadu Bungalow", "Tuggali"
        ],
        "Prakasam": [
            "Ongole", "Chirala", "Markapur", "Kandukur", "Addanki", "Yerragondapalem", "Giddalur", "Peddaraveedu",
            "Darsi", "Podili", "Kanigiri", "Tarlupadu", "Komarolu", "Santhanuthalapadu", "Chimakurthy",
            "Cumbum", "Bestavaripeta", "Pamur", "Parchur", "Singarayakonda", "Mundlamuru"
        ],
        "Nellore": [
            "Nellore", "Kavali", "Gudur", "Venkatagiri", "Atmakur", "Sullurpeta", "Rapur", "Naidupet",
            "Udayagiri", "Venkatachalam", "Tada", "Buchireddypalem", "Kaluvoya", "Kondapuram",
            "Varikuntapadu", "Dakkili", "Marripadu", "Pellakur", "Podalakur", "Sangam", "Thotapalligudur"
        ],
        "Srikakulam": [
            "Srikakulam", "Amadalavalasa", "Palasa", "Ichapuram", "Tekkali", "Narasannapeta", "Brahmanapalle",
            "Pathapatnam", "Kaviti", "Sompeta", "Kanchili", "Etcherla", "Rajam", "Vajrapu Kotturu",
            "Laveru", "Meliaputti", "Mandasa", "Vangara", "Kotabommali", "Ranastalam", "Burja"
        ],
        "Visakhapatnam": [
            "Visakhapatnam", "Anakapalle", "Bheemunipatnam", "Narsipatnam", "Pendurthi", "Chodavaram", "Malkapuram",
            "Yelamanchili", "Paravada", "Araku", "Nakkapalle", "Kasimkota", "Madugula", "Paderu",
            "Sabbavaram", "Rambilli", "Pedagantyada", "Chintapalli", "Hukumpeta", "Koyyuru", "Ananthagiri"
        ],
        "Vizianagaram": [
            "Vizianagaram", "Bobbili", "Parvatipuram", "Cheepurupalli", "Salur", "Nellimarla", "Dattirajeru",
            "Gajapathinagaram", "Garividi", "Badangi", "Kurupam", "Makkuva", "Pusapatirega", "Therlam",
            "Garugubilli", "Mentada", "Bondapalli", "Lakkavarapukota", "Srungavarapukota", "Kothavalasa", "Jami"
        ],
        "West Godavari": [
            "Eluru", "Bhimavaram", "Palacole", "Tadepalligudem", "Tanuku", "Nidadavole", "Kovvur", "Jangareddygudem",
            "Naraspur", "Achanta", "Pentapadu", "Polavaram", "Chintalapudi", "Palakollu", "Attili",
            "Veeravasaram", "Denduluru", "Unguturu", "Dwaraka Tirumala", "Bhimadole", "Iragavaram"
        ],
        "YSR Kadapa": [
            "Kadapa", "Proddatur", "Rajampet", "Pulivendula", "Jammalamadugu", "Mydukur", "Kamallakuntla", "Chennur",
            "Vempalle", "Lakkireddypalli", "Rayachoti", "Badvel", "Kamalapuram", "Kalasapadu", "Porumamilla",
            "Brahmamgarimattam", "Sidhout", "Chapad", "Atlur", "Duvvur", "Chinnamandem"
        ]
    },
    "Telangana": {
        "Adilabad": [
            "Adilabad", "Mancherial", "Nirmal", "Bellampalle", "Kagaznagar", "Kuntala", "Tandur",
            "Boath", "Utnoor", "Asifabad", "Jainad", "Ichoda", "Wankidi", "Kerimeri", "Indravelli",
            "Tamsi", "Jainoor", "Gudihatnoor", "Talamadugu", "Bejjur", "Sirpur (T)"
        ],
        "Bhadradri Kothagudem": [
            "Kothagudem", "Palvancha", "Yellandu", "Bhadrachalam", "Manuguru", "Sathupalli",
            "Chunchupalle", "Aswaraopeta", "Cherla", "Dammapeta", "Burgampahad", "Tekulapalle",
            "Julurpadu", "Dummugudem", "Laxmidevipalli", "Kunavaram"
        ],
        "Hyderabad": [
            "Hyderabad", "Secunderabad", "Kukatpally", "Gachibowli", "Uppal", "LB Nagar", "Malkajgiri", "Himayatnagar",
            "Mehdipatnam", "Charminar", "Ameerpet", "Begumpet", "Jubilee Hills", "Banjara Hills", "Madhapur",
            "Kondapur", "Miyapur", "Dilsukhnagar", "Abids", "Kompally", "Bachupally", "Shamirpet"
        ],
        "Jagtial": [
            "Jagtial", "Korutla", "Metpally", "Dharmapuri", "Raikal", "Kamalapur", "Ibrahimpatnam",
            "Velgatoor", "Mallial", "Sarangapur", "Gollapalli", "Pegadapalli", "Kathlapur"
        ],
        "Jangaon": [
            "Jangaon", "Cherial", "Narmetta", "Bachannapet", "Devaruppula", "Ghanpur", "Kothapet",
            "Lingalaghanpur", "Raghunathpalle", "Palakurthy", "Choutuppal", "Yadadri"
        ],
        "Karimnagar": [
            "Karimnagar", "Huzurabad", "Jammikunta", "Choppadandi", "Manakondur", "Sircilla", "Vemulawada",
            "Karimnagar Rural", "Kothapalli", "Vavilala", "Ellanthakunta", "Gangadhara", "Pegadapalli",
            "Husnabad", "Boinpalli", "Sirsilla", "Konaraopet"
        ],
        "Khammam": [
            "Khammam", "Wyra", "Sathupalli", "Madhira", "Kallur", "Palair", "Bhadrachalam",
            "Nelakondapalli", "Kusumanchi", "Mudigonda", "Penuballi", "Chintakani", "Tirumala Rao Peta",
            "Konijerla", "Vemsoor", "Bonakal"
        ],
        "Mahabubabad": [
            "Mahabubabad", "Thorrur", "Dornakal", "Gudur", "Kesamudram", "Maripeda", "Narsampet",
            "Danthalapally", "Bayyaram", "Garla", "Kuravi", "Nellikuduru", "Shankarampet"
        ],
        "Mahabubnagar": [
            "Mahabubnagar", "Jadcherla", "Makthal", "Narayanpet", "Kodangal", "Shadnagar", "Bhootpur",
            "Kosgi", "Kalwakurthy", "Wanaparthy", "Gadwal", "Alampur", "Devarakadra", "Ieeja",
            "Kollapur", "Vangoor", "Amangal"
        ],
        "Mancherial": [
            "Mancherial", "Bellampalle", "Naspur", "Luxettipet", "Mandamarri", "Kashipur", "Kondapur",
            "Chennur", "Hajipur", "Kotapalli", "Jannaram", "Nennal", "Dandepalli"
        ],
        "Medak": [
            "Medak", "Ramayampet", "Toopran", "Narsapur", "Chegunta", "Siddipet", "Dubbak",
            "Jogipet", "Papannapet", "Kulcharam", "Shivampet", "Regode", "Tekmal"
        ],
        "Medchal-Malkajgiri": [
            "Medchal", "Malkajgiri", "Kukatpally", "Quthbullapur", "Alwal", "Nagole", "Kachiguda",
            "Kapra", "Nacharam", "Uppal Kalan", "Keesara", "Ghatkesar", "Shamirpet", "Kompally",
            "Dundigal", "Balanagar"
        ],
        "Nagarkurnool": [
            "Nagarkurnool", "Kalwakurthy", "Achampet", "Kollapur", "Tadoor", "Lingala", "Amrabad",
            "Bijinapally", "Telkapally", "Uppununthala", "Pentlavalli"
        ],
        "Nalgonda": [
            "Nalgonda", "Miryalaguda", "Suryapet", "Devarakonda", "Nakrekal", "Chityal", "Narketpally",
            "Ramannapet", "Bhongir", "Yadagirigutta", "Huzurnagar", "Kodad", "Mattampally",
            "Choutuppal", "Munugode", "Valigonda"
        ],
        "Nirmal": [
            "Nirmal", "Bhainsa", "Khanapur", "Basar", "Lokeshwaram", "Mudhole", "Dilawarpur",
            "Mamda", "Sarangapur", "Kuntala", "Dasturabad"
        ],
        "Nizamabad": [
            "Nizamabad", "Bodhan", "Armoor", "Banswada", "Bheemgal", "Nandipet", "Yellareddy",
            "Kamareddy", "Pitlam", "Jakranpally", "Makloor", "Varni"
        ],
        "Ranga Reddy": [
            "Shamshabad", "Ibrahimpatnam", "Chevella", "Shadnagar", "Vikarabad", "Moinabad",
            "Rajendranagar", "Tandur", "Pargi", "Maheshwaram", "Shankarpally", "Pudur",
            "Farooqnagar", "Yacharam"
        ],
        "Sangareddy": [
            "Sangareddy", "Zaheerabad", "Sadasivpet", "Patancheru", "Andole", "Jogipet",
            "Narayanakhed", "Kalher", "Hatnoora", "Manoor", "Mogudampally", "Raikode"
        ],
        "Siddipet": [
            "Siddipet", "Gajwel", "Dubbak", "Husnabad", "Cheriyal", "Komuravelli", "Jagadevpur",
            "Nangunur", "Kondapak", "Mulugu", "Wargal", "Markook"
        ],
        "Suryapet": [
            "Suryapet", "Kodad", "Huzurnagar", "Nereducherla", "Tirumalagiri", "Thungaturthy",
            "Mothey", "Penpahad", "Garidepally", "Nadigudem", "Chivvemla"
        ],
        "Warangal": [
            "Warangal", "Hanamkonda", "Kazipet", "Parkal", "Wardhannapet", "Bhupalpally", "Nekkonda",
            "Geesugonda", "Nallabelly", "Atmakur", "Raiparthy", "Narsampet", "Eturnagaram",
            "Mulugu", "Tadvai", "Venkatapuram"
        ]
    }
};

// Load districts based on selected state
function loadDistricts() {
    const stateSelect = document.getElementById("stateFilter");
    const districtSelect = document.getElementById("districtFilter");
    const citySelect = document.getElementById("cityFilter");
    
    // Clear existing options
    districtSelect.innerHTML = '<option value="">All Districts</option>';
    citySelect.innerHTML = '<option value="">All Cities/Towns/Villages</option>';
    
    const selectedState = stateSelect.value;
    if (selectedState) {
        const districts = Object.keys(locationData[selectedState]);
        districts.forEach(district => {
            const option = document.createElement("option");
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
        });
    }
}

// Load cities based on selected district
function loadCities() {
    const stateSelect = document.getElementById("stateFilter");
    const districtSelect = document.getElementById("districtFilter");
    const citySelect = document.getElementById("cityFilter");
    
    // Clear existing city options
    citySelect.innerHTML = '<option value="">All Cities/Towns/Villages</option>';
    
    const selectedState = stateSelect.value;
    const selectedDistrict = districtSelect.value;
    
    if (selectedState && selectedDistrict) {
        const cities = locationData[selectedState][selectedDistrict];
        cities.forEach(city => {
            const option = document.createElement("option");
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
        });
    }
}

// Reset filters
function resetFilters() {
    document.getElementById("bloodGroupFilter").value = "";
    document.getElementById("stateFilter").value = "";
    document.getElementById("districtFilter").innerHTML = '<option value="">All Districts</option>';
    document.getElementById("cityFilter").innerHTML = '<option value="">All Cities/Towns/Villages</option>';
    
    // Load all donors
    loadDonors();
}

// Apply filters
function applyFilters() {
    const bloodGroup = document.getElementById("bloodGroupFilter").value;
    const state = document.getElementById("stateFilter").value;
    const district = document.getElementById("districtFilter").value;
    const city = document.getElementById("cityFilter").value;
    
    // Show loading indicator
    const donorList = document.getElementById("donorList");
    donorList.innerHTML = "<p style='text-align: center; color: var(--text-light);'>Loading donors...</p>";
    
    // Fetch donors and apply filters
    fetchAndFilterDonors(bloodGroup, state, district, city);
}

// Fetch and filter donors with proper handling for nested location object
function fetchAndFilterDonors(bloodGroup, state, district, city) {
    console.log("Fetching donors with filters:", { bloodGroup, state, district, city });
    
    fetch('https://blood-backend-production-c41c.up.railway.app/donors')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log("Retrieved donors:", data.length);
            const donorList = document.getElementById("donorList");
            donorList.innerHTML = ""; // Clear existing list
            
            // Filter donors based on criteria
            let filteredDonors = data;
            
            if (bloodGroup) {
                console.log(`Filtering by blood group: ${bloodGroup}`);
                filteredDonors = filteredDonors.filter(donor => donor.bloodType === bloodGroup);
            }
            
            if (state || district || city) {
                console.log(`Filtering by location: ${state}, ${district}, ${city}`);
                
                filteredDonors = filteredDonors.filter(donor => {
                    // Check if donor has location and it's properly structured
                    if (!donor.location) return false;
                    
                    // Handle location as nested object (as per your schema)
                    if (state && donor.location.state !== state) {
                        return false;
                    }
                    
                    if (district && donor.location.district !== district) {
                        return false;
                    }
                    
                    if (city && donor.location.city !== city) {
                        return false;
                    }
                    
                    return true;
                });
            }
            
            console.log("Filtered donors:", filteredDonors.length);
            
            if (filteredDonors.length === 0) {
                donorList.innerHTML = "<p style='text-align: center; color: var(--text-light);'>No donors found matching your criteria.</p>";
                return;
            }
            
            // Sort the donors alphabetically by name
            filteredDonors.sort((a, b) => a.name.localeCompare(b.name));
            
            // Display the filtered donors
            filteredDonors.forEach(donor => {
                const listItem = document.createElement("li");
                
                const donorInfo = document.createElement("div");
                donorInfo.className = "donor-info";
                
                const bloodType = document.createElement("div");
                bloodType.className = "blood-type";
                bloodType.textContent = donor.bloodType;
                
                const donorDetails = document.createElement("div");
                donorDetails.className = "donor-details";
                
                const donorName = document.createElement("div");
                donorName.className = "donor-name";
                donorName.textContent = donor.name;
                
                // Format location display based on the nested location object
                const locationDisplay = `${donor.location.city}, ${donor.location.district}, ${donor.location.state}`;
                
                const donorLocation = document.createElement("div");
                donorLocation.className = "donor-location";
                donorLocation.textContent = `${locationDisplay} â€¢ Age: ${donor.age}`;
                
                // const contactBtn = document.createElement("button");
                // contactBtn.className = "contact-btn";
                // contactBtn.textContent = "Contact";
                // contactBtn.onclick = function() {
                //     alert(`Contact ${donor.name} at ${donor.number}`);
                // };

                // Enhanced contact button with mobile/desktop detection
                const contactBtn = document.createElement("button");
                contactBtn.className = "contact-btn";
                contactBtn.innerHTML = `
                    <i class="fas fa-phone"></i>
                    <span>Contact</span>
                `;

                // Function to detect if device is mobile
                function isMobileDevice() {
                    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                        (navigator.maxTouchPoints && navigator.maxTouchPoints > 2 && /MacIntel/.test(navigator.platform));
                }

                // Function to detect if device has touch capability
                function isTouchDevice() {
                    return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                }

                // Enhanced contact button click handler
                contactBtn.onclick = function(e) {
                    e.preventDefault();
                    
                    if (isMobileDevice() || isTouchDevice()) {
                        // Mobile devices - redirect to phone app
                        try {
                            // Create phone link and trigger it
                            const phoneLink = document.createElement('a');
                            phoneLink.href = `tel:${donor.number}`;
                            phoneLink.style.display = 'none';
                            document.body.appendChild(phoneLink);
                            phoneLink.click();
                            document.body.removeChild(phoneLink);
                            
                            // Optional: Show confirmation
                            setTimeout(() => {
                                const toast = createToast(`Calling ${donor.name}...`, 'success');
                                document.body.appendChild(toast);
                                setTimeout(() => toast.remove(), 3000);
                            }, 100);
                        } catch (error) {
                            // Fallback if tel: link fails
                            alert(`Call ${donor.name} at ${donor.number}`);
                        }
                    } else {
                        // Desktop/Laptop - show contact number in a modal
                        showContactModal(donor);
                    }
                };
                // Function to show contact modal on desktop
                function showContactModal(donor) {
                    // Create modal overlay
                    const modalOverlay = document.createElement('div');
                    modalOverlay.className = 'modal-overlay';
                    modalOverlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.8);
                        backdrop-filter: blur(10px);
                        z-index: 10000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: fadeIn 0.3s ease-out;
                    `;
                    
                    // Create modal content
                    const modal = document.createElement('div');
                    modal.className = 'contact-modal';
                    modal.style.cssText = `
                        background: var(--bg-card);
                        border-radius: 20px;
                        padding: 32px;
                        max-width: 400px;
                        width: 90%;
                        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                        border: 2px solid var(--border);
                        position: relative;
                        animation: slideUp 0.3s ease-out;
                        text-align: center;
                    `;
                    
                    modal.innerHTML = `
                        <button class="modal-close" style="
                            position: absolute;
                            top: 16px;
                            right: 16px;
                            background: none;
                            border: none;
                            color: var(--text-muted);
                            font-size: 24px;
                            cursor: pointer;
                            padding: 8px;
                            border-radius: 50%;
                            transition: all 0.3s ease;
                        ">
                            <i class="fas fa-times"></i>
                        </button>
                        
                        <div class="modal-header" style="margin-bottom: 24px;">
                            <div class="blood-type-large" style="
                                background: var(--gradient-primary);
                                color: white;
                                width: 80px;
                                height: 80px;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 24px;
                                font-weight: bold;
                                margin: 0 auto 16px;
                                box-shadow: 0 8px 24px rgba(220, 38, 38, 0.3);
                            ">
                                ${donor.bloodType}
                            </div>
                            <h3 style="color: var(--text-primary); margin-bottom: 8px; font-size: 24px;">
                                ${donor.name}
                            </h3>
                            <p style="color: var(--text-muted); display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-map-marker-alt"></i>
                                ${locationDisplay}
                            </p>
                        </div>
                        
                        <div class="contact-info" style="
                            background: var(--bg-secondary);
                            border-radius: 12px;
                            padding: 20px;
                            margin: 24px 0;
                            border: 1px solid var(--border);
                        ">
                            <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">
                                Contact Number
                            </p>
                            <div class="phone-number" style="
                                font-size: 28px;
                                font-weight: bold;
                                color: var(--primary);
                                font-family: 'Courier New', monospace;
                                letter-spacing: 2px;
                                margin-bottom: 16px;
                            ">
                                ${donor.number}
                            </div>
                            <button class="copy-btn" style="
                                background: var(--gradient-secondary);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.3s ease;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                margin: 0 auto;
                            ">
                                <i class="fas fa-copy"></i>
                                Copy Number
                            </button>
                        </div>
                        
                        <div class="modal-actions" style="display: flex; gap: 12px; justify-content: center;">
                            <button class="btn-call" style="
                                background: var(--gradient-success);
                                color: white;
                                border: none;
                                padding: 14px 28px;
                                border-radius: 10px;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.3s ease;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                flex: 1;
                                justify-content: center;
                            ">
                                <i class="fas fa-phone"></i>
                                Call Now
                            </button>
                        
                        </div>
                    `;
                    
                    modalOverlay.appendChild(modal);
                    document.body.appendChild(modalOverlay);
                    
                    // Add event listeners
                    const closeBtn = modal.querySelector('.modal-close');
                    const copyBtn = modal.querySelector('.copy-btn');
                    const callBtn = modal.querySelector('.btn-call');
                    const messageBtn = modal.querySelector('.btn-message');
                    
                    // Close modal function
                    function closeModal() {
                        modalOverlay.style.animation = 'fadeOut 0.3s ease-out';
                        modal.style.animation = 'slideDown 0.3s ease-out';
                        setTimeout(() => {
                            document.body.removeChild(modalOverlay);
                        }, 300);
                    }
                    
                    // Close button
                    closeBtn.onclick = closeModal;
                    
                    // Close on overlay click
                    modalOverlay.onclick = function(e) {
                        if (e.target === modalOverlay) {
                            closeModal();
                        }
                    };
                    
                    // Copy number to clipboard
                    copyBtn.onclick = async function() {
                        try {
                            await navigator.clipboard.writeText(donor.number);
                            copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                            copyBtn.style.background = 'var(--gradient-success)';
                            setTimeout(() => {
                                copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Number';
                                copyBtn.style.background = 'var(--gradient-secondary)';
                            }, 2000);
                        } catch (err) {
                            // Fallback for older browsers
                            const textArea = document.createElement('textarea');
                            textArea.value = donor.number;
                            document.body.appendChild(textArea);
                            textArea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textArea);
                            
                            copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                            copyBtn.style.background = 'var(--gradient-success)';
                            setTimeout(() => {
                                copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Number';
                                copyBtn.style.background = 'var(--gradient-secondary)';
                            }, 2000);
                        }
                    };
                    
                    // Call button
                    callBtn.onclick = function() {
                        window.location.href = `tel:${donor.number}`;
                        closeModal();
                    };
                    
                    // Message button
                    messageBtn.onclick = function() {
                        window.location.href = `sms:${donor.number}`;
                        closeModal();
                    };
                    
                    // Add hover effects
                    const buttons = modal.querySelectorAll('button');
                    buttons.forEach(btn => {
                        btn.addEventListener('mouseenter', function() {
                            this.style.transform = 'translateY(-2px)';
                            this.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.3)';
                        });
                        
                        btn.addEventListener('mouseleave', function() {
                            this.style.transform = 'translateY(0)';
                            this.style.boxShadow = 'none';
                        });
                    });
                    
                    // Close modal on Escape key
                    document.addEventListener('keydown', function(e) {
                        if (e.key === 'Escape') {
                            closeModal();
                        }
                    });
                }

                // Add required CSS animations
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                    
                    @keyframes slideUp {
                        from {
                            transform: translateY(50px);
                            opacity: 0;
                        }
                        to {
                            transform: translateY(0);
                            opacity: 1;
                        }
                    }
                    
                    @keyframes slideDown {
                        from {
                            transform: translateY(0);
                            opacity: 1;
                        }
                        to {
                            transform: translateY(50px);
                            opacity: 0;
                        }
                    }
                    
                    .modal-close:hover {
                        background: var(--bg-secondary) !important;
                        color: var(--text-primary) !important;
                    }
                `;

            document.head.appendChild(style);
                            donorDetails.appendChild(donorName);
                            donorDetails.appendChild(donorLocation);
                            donorInfo.appendChild(bloodType);
                            donorInfo.appendChild(donorDetails);
                            listItem.appendChild(donorInfo);
                            listItem.appendChild(contactBtn);
                            
                            donorList.appendChild(listItem);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching donors:', error);
                        const donorList = document.getElementById("donorList");
                        donorList.innerHTML = `<p style='text-align: center; color: var(--primary);'>
                            Error loading donors: ${error.message}<br>
                            Please check if your API server is running at http://localhost:3000
                        </p>`;
                    });
            }

            // Initial load of donors
            function loadDonors() {
                // Simply call fetchAndFilterDonors with no filters
                fetchAndFilterDonors("", "", "", "");
            }

            // Make sure event listeners are properly set up
            document.addEventListener('DOMContentLoaded', () => {
                // Initialize the donor list 
                loadDonors();
                
                // Set up event listeners for filter controls if they exist
                const stateFilter = document.getElementById("stateFilter");
                const districtFilter = document.getElementById("districtFilter");
                const filterButton = document.getElementById("applyFilters");
                const resetButton = document.getElementById("resetFilters");
                
                if (stateFilter) {
                    stateFilter.addEventListener('change', loadDistricts);
                }
                
                if (districtFilter) {
                    districtFilter.addEventListener('change', loadCities);
                }
                
                if (filterButton) {
                    filterButton.addEventListener('click', applyFilters);
                }
                
                if (resetButton) {
                    resetButton.addEventListener('click', resetFilters);
                }
            });
    </script>
</body>
</html>